<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ MCM & MCD Challenge - CUPREX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="src/css/animations.css">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --dark-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-gradient);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        h1, h2, h3, .font-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        /* Glass Morphism Effect */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Modern Button Styles */
        .btn-modern {
            background: var(--secondary-gradient);
            border: none;
            border-radius: 15px;
            padding: 16px 32px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-modern:hover::before {
            left: 100%;
        }

        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .btn-modern:active {
            transform: translateY(0);
        }

        /* Game Buttons */
        .btn-red {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 20px;
        }
        .btn-blue {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-radius: 20px;
        }
        .btn-green {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            border-radius: 20px;
        }
        .btn-yellow {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            border-radius: 20px;
        }

        .btn-shape {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.3rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            width: 100%;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-shape::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .btn-shape:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-shape:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
            50% { box-shadow: 0 0 40px rgba(255, 255, 255, 0.4); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        .animate-slide-up { animation: slideInUp 0.6s ease-out; }
        .animate-fade-left { animation: fadeInLeft 0.8s ease-out; }
        .animate-bounce-in { animation: bounceIn 0.8s ease-out; }

        /* Step Animation for Study Guide */
        .step-item {
            opacity: 0;
            transform: translateX(-30px);
            transition: all 0.6s ease;
        }

        .step-item.revealed {
            opacity: 1;
            transform: translateX(0);
        }

        .step-item:nth-child(1) { transition-delay: 0.1s; }
        .step-item:nth-child(2) { transition-delay: 0.2s; }
        .step-item:nth-child(3) { transition-delay: 0.3s; }
        .step-item:nth-child(4) { transition-delay: 0.4s; }
        .step-item:nth-child(5) { transition-delay: 0.5s; }

        /* Modern Cards */
        .modern-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        /* XP and Progress */
        .xp-bar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .xp-bar {
            background: var(--success-gradient);
            transition: width 0.8s ease-out;
            border-radius: 20px;
        }

        /* Achievement */
        #achievement-notification {
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateY(150%) translateX(-50%);
            opacity: 0;
            position: fixed;
            bottom: 30px;
            left: 50%;
            z-index: 1000;
            background: var(--warning-gradient);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        #achievement-notification.show {
            transform: translateY(0) translateX(-50%);
            opacity: 1;
        }

        /* Timer */
        .timer-bar {
            transition: width 1s linear;
            background: var(--warning-gradient);
            border-radius: 10px;
        }

        /* Study Container */
        .study-container {
            max-height: 85vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .study-container::-webkit-scrollbar {
            width: 8px;
        }

        .study-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .study-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .btn-shape {
                font-size: 1.1rem;
                padding: 16px;
            }

            h1 {
                font-size: 2.5rem !important;
            }

            h2 {
                font-size: 2rem !important;
            }
        }

        /* Icons */
        .icon-bounce {
            display: inline-block;
            animation: float 2s ease-in-out infinite;
        }

        .gradient-text {
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .neon-glow {
            text-shadow:
                0 0 5px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(255, 255, 255, 0.6),
                0 0 15px rgba(255, 255, 255, 0.4),
                0 0 20px rgba(103, 126, 234, 0.8),
                0 0 35px rgba(103, 126, 234, 0.6);
        }

        .correct-answer {
            animation: pulse-success 1s ease-in-out;
            box-shadow: 0 0 30px 10px rgba(85, 239, 196, 0.6);
        }

        .wrong-answer {
            opacity: 0.6;
            filter: grayscale(50%);
        }

        .disabled-button { pointer-events: none; }

        @keyframes pulse-success {
            0% { transform: scale(1); box-shadow: 0 0 30px 10px rgba(85, 239, 196, 0.6); }
            50% { transform: scale(1.03); box-shadow: 0 0 40px 15px rgba(85, 239, 196, 0.8); }
            100% { transform: scale(1); box-shadow: 0 0 30px 10px rgba(85, 239, 196, 0.6); }
        }

        /* Interactive elements */
        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="particles-js"></div>

    <div id="container" class="w-full max-w-5xl mx-auto text-center relative z-10">

        <!-- Pantalla de Inicio -->
        <div id="start-screen" class="animate-slide-up">
            <div class="animate-float mb-8">
                <h1 class="text-6xl md:text-8xl font-black tracking-tighter mb-4 font-title neon-glow">
                    <i class="fas fa-calculator icon-bounce mr-4"></i>
                    MCM & MCD Challenge
                </h1>
                <h2 class="text-3xl md:text-5xl font-bold gradient-text font-title">
                    üéØ CUPREX - EXANI II
                </h2>
            </div>

            <!-- Gamification Profile -->
            <div id="gamification-profile" class="glass modern-card hover-lift mb-8 max-w-md mx-auto animate-bounce-in">
                <div class="flex items-center justify-between mb-4">
                    <div id="profile-level" class="font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-500 text-black rounded-full w-16 h-16 flex items-center justify-center font-title shadow-lg animate-glow">
                        1
                    </div>
                    <div class="text-left flex-grow ml-4">
                        <div id="profile-name" class="font-bold text-xl flex items-center">
                            <i class="fas fa-user-graduate mr-2 text-blue-300"></i>
                            Estudiante
                        </div>
                        <div id="profile-achievements" class="text-sm flex items-center text-yellow-300">
                            <i class="fas fa-trophy mr-1"></i>
                            Logros: 0/5
                        </div>
                    </div>
                </div>
                <div class="xp-bar-container w-full h-6 mb-2">
                    <div id="profile-xp-bar" class="xp-bar h-6" style="width: 0%;"></div>
                </div>
                <div id="profile-xp-text" class="text-sm text-right text-blue-200 font-semibold">
                    <i class="fas fa-star mr-1"></i>
                    0/100 XP
                </div>
            </div>

            <div class="glass-strong modern-card hover-lift mb-8 max-w-2xl mx-auto animate-fade-left">
                <h3 class="text-2xl font-bold mb-6 font-title flex items-center justify-center">
                    <i class="fas fa-cogs mr-3 text-purple-300"></i>
                    Configuraci√≥n del Desaf√≠o
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                    <div class="text-center">
                        <label for="question-count" class="font-bold block mb-2 text-blue-200">
                            <i class="fas fa-question-circle mr-2"></i>
                            N¬∫ de Preguntas:
                        </label>
                        <input type="number" id="question-count" value="10" min="1" max="25"
                               class="w-24 text-center text-gray-800 font-bold p-3 rounded-xl border-2 border-blue-300 focus:border-blue-500 transition-all">
                    </div>
                    <div class="text-center">
                        <label for="time-limit" class="font-bold block mb-2 text-green-200">
                            <i class="fas fa-clock mr-2"></i>
                            Segundos/Pregunta:
                        </label>
                        <input type="number" id="time-limit" value="90" min="10" step="5"
                               class="w-24 text-center text-gray-800 font-bold p-3 rounded-xl border-2 border-green-300 focus:border-green-500 transition-all">
                    </div>
                    <div class="text-center">
                        <label for="question-order" class="font-bold block mb-2 text-yellow-200">
                            <i class="fas fa-shuffle mr-2"></i>
                            Orden:
                        </label>
                        <select id="question-order"
                                class="w-36 text-center text-gray-800 font-bold p-3 rounded-xl border-2 border-yellow-300 focus:border-yellow-500 transition-all">
                            <option value="random">üé≤ Aleatorio</option>
                            <option value="sequential">üìä En Orden</option>
                        </select>
                    </div>
                </div>
            </div>

            <button id="start-button" class="btn-modern text-4xl font-bold py-6 px-16 mb-8 font-title animate-glow hover-lift">
                <i class="fas fa-play mr-3"></i>
                ¬°Empezar Desaf√≠o!
            </button>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-6 max-w-4xl mx-auto">
                <button id="study-guide-btn" class="glass modern-card hover-lift font-bold py-4 px-6 transition-all group">
                    <i class="fas fa-graduation-cap text-2xl mb-2 text-purple-300 group-hover:scale-110 transition-transform"></i>
                    <div class="font-title">Gu√≠a de Estudio</div>
                    <div class="text-sm opacity-75">Aprende paso a paso</div>
                </button>
                <button id="view-problems-btn" class="glass modern-card hover-lift font-bold py-4 px-6 transition-all group">
                    <i class="fas fa-list-alt text-2xl mb-2 text-blue-300 group-hover:scale-110 transition-transform"></i>
                    <div class="font-title">Banco de Problemas</div>
                    <div class="text-sm opacity-75">25 ejercicios</div>
                </button>
                <button id="view-solutions-btn" class="glass modern-card hover-lift font-bold py-4 px-6 transition-all group">
                    <i class="fas fa-lightbulb text-2xl mb-2 text-green-300 group-hover:scale-110 transition-transform"></i>
                    <div class="font-title">Soluciones</div>
                    <div class="text-sm opacity-75">Respuestas detalladas</div>
                </button>
                <button id="view-references-btn" class="glass modern-card hover-lift font-bold py-4 px-6 transition-all group">
                    <i class="fas fa-book text-2xl mb-2 text-yellow-300 group-hover:scale-110 transition-transform"></i>
                    <div class="font-title">Referencias</div>
                    <div class="text-sm opacity-75">Material de apoyo</div>
                </button>
            </div>
        </div>

        <!-- Contenedor para material de estudio -->
        <div id="study-material-container" class="hidden glass modern-card text-white p-8 text-left study-container">
            <div id="study-content"></div>
            <button id="close-study-btn" class="mt-6 btn-modern w-full font-title">
                <i class="fas fa-times mr-2"></i>
                Cerrar
            </button>
        </div>


        <!-- Pantalla del Quiz -->
        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center glass-strong text-white p-4 rounded-t-lg font-title">
                <div class="flex items-center gap-4">
                    <button id="exit-quiz-btn" class="glass modern-card px-4 py-2 hover-lift text-sm font-semibold">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Salir
                    </button>
                    <div id="question-counter" class="text-xl font-bold">1 de 10</div>
                </div>
                <div class="text-2xl font-black">Desaf√≠o MCM y MCD</div>
                <div id="score" class="text-xl font-bold">Puntos: 0</div>
            </div>
            <div class="bg-gray-800 p-8">
                <div id="timer-container" class="w-full bg-gray-600 rounded-full h-4 mb-6">
                    <div id="timer-bar" class="bg-yellow-400 h-4 rounded-full" style="width: 100%;"></div>
                </div>
                <h2 id="question-text" class="text-2xl md:text-3xl font-bold mb-4 min-h-[100px] font-title">Cargando pregunta...</h2>
                <div id="tip-text" class="text-yellow-300 italic h-6"></div>
            </div>
            <div class="flex flex-col gap-4 p-4 bg-gray-800 rounded-b-lg">
                <button data-option="0" class="answer-btn btn-shape btn-red rounded-lg h-24 font-title"></button>
                <button data-option="1" class="answer-btn btn-shape btn-blue rounded-lg h-24 font-title"></button>
                <button data-option="2" class="answer-btn btn-shape btn-green rounded-lg h-24 font-title"></button>
                <button id="next-button" class="btn-shape bg-gray-700 rounded-lg h-24 hidden mt-4 font-title">Siguiente</button>
            </div>
            <div id="feedback-text" class="mt-4 text-xl font-bold h-8"></div>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="results-screen" class="hidden">
            <h1 class="text-5xl font-black mb-4 font-title">¬°Juego Terminado!</h1>
            <div class="bg-white text-gray-800 rounded-lg p-8 text-center shadow-2xl">
                <h2 class="text-3xl font-bold mb-2 font-title">Tu Puntuaci√≥n Final</h2>
                <p id="final-score" class="text-8xl font-black text-blue-600 mb-2 font-title">0</p>
                <p id="xp-gain-text" class="text-2xl font-bold text-green-500 mb-6"></p>
                <p id="final-summary" class="text-2xl mb-8">Obtuviste 0 de 10 correctas.</p>
                <button id="restart-button" class="bg-green-500 text-white text-2xl font-bold py-3 px-10 rounded-lg hover:bg-green-600 transition-transform transform hover:scale-105 font-title">
                    Jugar de Nuevo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notificaci√≥n de Logro -->
    <div id="achievement-notification" class="bg-yellow-400 text-black p-4 rounded-lg shadow-lg flex items-center gap-4">
        <div class="text-3xl">üèÜ</div>
        <div>
            <div id="achievement-title" class="font-bold">¬°Logro Desbloqueado!</div>
            <div id="achievement-desc"></div>
        </div>
    </div>

    <script type="module">
        // Import modular JavaScript files
        import('./src/js/modules/math-utils.js')
            .then(module => { window.MathUtils = module.default || module; })
            .catch(err => console.error('Failed to load math-utils.js:', err));

        import('./src/js/modules/quiz-manager.js')
            .then(module => { window.QuizManager = module.default || module; })
            .catch(err => console.error('Failed to load quiz-manager.js:', err));

        import('./src/js/data/questions.js')
            .then(module => { window.QuestionDatabase = module.default || module; })
            .catch(err => console.error('Failed to load questions.js:', err));

        const allQuestions = [
            // (25 questions from previous context, redacted for brevity)
            { question: "Tres luces intermitentes se encienden a intervalos de 4, 6 y 10 segundos. Si coinciden a las 7:00 p.m., ¬ødespu√©s de cu√°ntos segundos volver√°n a coincidir?", answers: [ { text: "60 segundos", correct: true, explanation: "¬°Correcto! Se busca un 'punto de encuentro' futuro, lo que requiere el M√≠nimo Com√∫n M√∫ltiplo (mcm). El mcm de 4, 6 y 10 es 60." }, { text: "2 segundos", correct: false, explanation: "Incorrecto. Este valor es el M√°ximo Com√∫n Divisor (mcd) de 4 y 6. El mcd se usa para 'dividir' o 'repartir' en partes iguales, no para encontrar futuras coincidencias." }, { text: "120 segundos", correct: false, explanation: "Incorrecto. Aunque 120 es un m√∫ltiplo com√∫n de los tres n√∫meros, no es el *m√≠nimo*. El mcm es el primer punto en el que coinciden, que es 60." } ] },
            { question: "Un carpintero quiere cortar dos listones de madera de 90 cm y 120 cm en trozos de igual longitud, lo m√°s largos posible. ¬øCu√°l debe ser la longitud de cada trozo?", answers: [ { text: "10 cm", correct: false, explanation: "Incorrecto. Aunque 10 cm es un divisor com√∫n de 90 y 120, no es el *m√°ximo* posible. Se pueden hacer trozos m√°s grandes." }, { text: "360 cm", correct: false, explanation: "Incorrecto. Este valor es el mcm. No puedes cortar un list√≥n de 90 cm en trozos de 360 cm. El mcm se usa para encontrar m√∫ltiplos, no divisores." }, { text: "30 cm", correct: true, explanation: "¬°Correcto! Se busca 'dividir' en partes iguales y lo 'm√°s largas posible', lo que indica que se necesita el M√°ximo Com√∫n Divisor (mcd). El mcd de 90 y 120 es 30." } ] },
            { question: "Calcule el M√°ximo Com√∫n Divisor (mcd) de 24, 36 y 48.", answers: [ { text: "12", correct: true, explanation: "¬°Correcto! El 12 es el n√∫mero m√°s grande que puede dividir exactamente a 24 (12x2), 36 (12x3) y 48 (12x4)." }, { text: "144", correct: false, explanation: "Incorrecto. Este valor es el mcm de los tres n√∫meros. El mcd debe ser menor o igual al n√∫mero m√°s peque√±o del grupo (24)." }, { text: "6", correct: false, explanation: "Incorrecto. Aunque 6 es un divisor com√∫n, no es el *m√°ximo*. El 12 tambi√©n es un divisor com√∫n y es m√°s grande." } ] },
            { question: "Un paciente toma un jarabe cada 6 horas y una pastilla cada 8 horas. Si tom√≥ ambos a las 9:00 a.m., ¬øa qu√© hora volver√° a tomar ambos medicamentos juntos?", answers: [ { text: "A las 9:00 a.m. del siguiente d√≠a", correct: true, explanation: "¬°Correcto! Buscamos la pr√≥xima coincidencia en el tiempo, por lo que usamos el mcm. El mcm de 6 y 8 es 24. Por lo tanto, coincidir√°n 24 horas despu√©s, que es a las 9:00 a.m. del d√≠a siguiente." }, { text: "A la 1:00 p.m. del mismo d√≠a", correct: false, explanation: "Incorrecto. Esto ser√≠a solo 4 horas despu√©s. 4 no es m√∫ltiplo ni de 6 ni de 8." }, { text: "A las 9:00 p.m. del mismo d√≠a", correct: false, explanation: "Incorrecto. Esto es 12 horas despu√©s. A las 12 horas, habr√≠a tomado el jarabe (6x2) pero no la pastilla (8x1.5)." } ] },
            { question: "Calcule el M√≠nimo Com√∫n M√∫ltiplo (mcm) de 15, 20 y 30.", answers: [ { text: "5", correct: false, explanation: "Incorrecto. Este es el mcd de los tres n√∫meros. El mcm debe ser mayor o igual al n√∫mero m√°s grande del grupo (30)." }, { text: "60", correct: true, explanation: "¬°Correcto! 60 es el n√∫mero m√°s peque√±o que puede ser dividido exactamente por 15 (15x4), 20 (20x3) y 30 (30x2)." }, { text: "120", correct: false, explanation: "Incorrecto. 120 es un m√∫ltiplo com√∫n, pero no es el *m√≠nimo*. El 60 tambi√©n es un m√∫ltiplo com√∫n y es m√°s peque√±o." } ] },
            { question: "Se tienen 54 chocolates y 72 caramelos. Se quieren armar bolsas con la misma cantidad de cada dulce, de modo que se use el mayor n√∫mero de bolsas posible. ¬øCu√°ntos chocolates habr√° en cada bolsa?", answers: [ { text: "18", correct: false, explanation: "Incorrecto. ¬°Cuidado! 18 es el mcd, que representa el n√∫mero total de bolsas que se pueden armar. La pregunta es cu√°ntos *chocolates* hay en cada bolsa." }, { text: "4", correct: false, explanation: "Incorrecto. Este es el n√∫mero de *caramelos* por bolsa (72 caramelos / 18 bolsas = 4)." }, { text: "3", correct: true, explanation: "¬°Correcto! Es un problema de dos pasos. Primero, el mcd(54, 72) = 18 nos da el n√∫mero de bolsas. Luego, 54 chocolates / 18 bolsas = 3 chocolates por bolsa." } ] },
            { question: "Si el mcd de dos n√∫meros es 6 y su mcm es 72, y uno de los n√∫meros es 18, ¬øcu√°l es el otro n√∫mero?", answers: [ { text: "24", correct: true, explanation: "¬°Correcto! Se usa la propiedad: a √ó b = mcd(a,b) √ó mcm(a,b). Entonces, 18 √ó b = 6 √ó 72, que es 432. Despejando b: 432 / 18 = 24." }, { text: "12", correct: false, explanation: "Incorrecto. Si los n√∫meros fueran 18 y 12, su mcd ser√≠a 6, pero su mcm ser√≠a 36, no 72." }, { text: "36", correct: false, explanation: "Incorrecto. Si los n√∫meros fueran 18 y 36, su mcd ser√≠a 18, no 6." } ] },
            { question: "Ana va a la biblioteca cada 4 d√≠as y Luis va cada 5 d√≠as. Si hoy se encontraron, ¬øen cu√°ntos d√≠as volver√°n a encontrarse?", answers: [ { text: "10 d√≠as", correct: false, explanation: "Incorrecto. En 10 d√≠as, Luis habr√° ido dos veces (5x2), pero Ana no (4x2.5)." }, { text: "20 d√≠as", correct: true, explanation: "¬°Correcto! Se busca el pr√≥ximo punto de encuentro, por lo que es el mcm. Como 4 y 5 son primos entre s√≠, su mcm es su producto: 4 √ó 5 = 20." }, { text: "9 d√≠as", correct: false, explanation: "Incorrecto. Este valor es la suma de los d√≠as (4+5). La suma no tiene relevancia para encontrar una coincidencia de m√∫ltiplos." } ] },
            { question: "Calcule el mcd de 100 y 150.", answers: [ { text: "25", correct: false, explanation: "Incorrecto. 25 es un divisor com√∫n, pero no es el *m√°ximo*. Hay un divisor m√°s grande que ambos comparten." }, { text: "50", correct: true, explanation: "¬°Correcto! 50 es el n√∫mero m√°s grande que divide a 100 (50x2) y 150 (50x3) de forma exacta." }, { text: "300", correct: false, explanation: "Incorrecto. Este es el mcm de 100 y 150. Recuerda que el mcd no puede ser m√°s grande que los n√∫meros originales." } ] },
            { question: "¬øCu√°l es el mcm de dos n√∫meros primos diferentes, como 7 y 13?", answers: [ { text: "1", correct: false, explanation: "Incorrecto. El 1 es el mcd de cualquier par de n√∫meros primos, no el mcm." }, { text: "Su suma (20)", correct: false, explanation: "Incorrecto. La suma no se utiliza para calcular el mcm." }, { text: "Su producto (91)", correct: true, explanation: "¬°Correcto! Como los n√∫meros primos no comparten factores (excepto el 1), su M√≠nimo Com√∫n M√∫ltiplo es siempre el resultado de multiplicarlos." } ] },
            { question: "Dos engranajes tienen 18 y 24 dientes. Si empiezan acoplados, ¬øcu√°ntas vueltas debe dar el engranaje m√°s peque√±o para que vuelvan a la posici√≥n inicial?", answers: [ { text: "3 vueltas", correct: false, explanation: "Incorrecto. Esto es el n√∫mero de vueltas que da el engranaje grande (72/24=3). La pregunta es sobre el engranaje peque√±o." }, { text: "4 vueltas", correct: true, explanation: "¬°Correcto! Se busca una coincidencia, un mcm. El mcm(18, 24) es 72. Para saber las vueltas del engranaje peque√±o, dividimos 72 / 18 = 4 vueltas." }, { text: "72 vueltas", correct: false, explanation: "Incorrecto. 72 es el n√∫mero total de dientes que deben pasar (el mcm), no el n√∫mero de vueltas del engranaje." } ] },
            { question: "Se quiere embaldosar una habitaci√≥n de 480 cm de largo por 360 cm de ancho con baldosas cuadradas, lo m√°s grandes posible. ¬øCu√°nto medir√° el lado de cada baldosa?", answers: [ { text: "1440 cm", correct: false, explanation: "Incorrecto. Este es el mcm. No puedes usar una baldosa m√°s grande que la propia habitaci√≥n. Se pide dividir el √°rea, no multiplicarla." }, { text: "60 cm", correct: false, explanation: "Incorrecto. 60 es un divisor com√∫n, pero no es el m√°s grande posible. El mcd es mayor." }, { text: "120 cm", correct: true, explanation: "¬°Correcto! Se pide 'dividir' el suelo en partes 'lo m√°s grandes posible', lo que indica el mcd. El mcd(480, 360) es 120 cm." } ] },
            { question: "Calcule el mcm de 9, 12 y 18.", answers: [ { text: "3", correct: false, explanation: "Incorrecto. Este es el mcd de los tres n√∫meros. El mcm siempre es mayor o igual al n√∫mero m√°s grande del grupo." }, { text: "36", correct: true, explanation: "¬°Correcto! 36 es el n√∫mero m√°s peque√±o que es divisible por 9 (9x4), 12 (12x3) y 18 (18x2)." }, { text: "72", correct: false, explanation: "Incorrecto. 72 es un m√∫ltiplo com√∫n, pero no es el *m√≠nimo*. 36 es m√°s peque√±o y tambi√©n es un m√∫ltiplo com√∫n." } ] },
            { question: "Calcule el mcd de 70, 105 y 140.", answers: [ { text: "35", correct: true, explanation: "¬°Correcto! 35 es el n√∫mero m√°s grande que divide a 70 (35x2), 105 (35x3) y 140 (35x4)." }, { text: "420", correct: false, explanation: "Incorrecto. Este es el mcm. El mcd debe ser un divisor, por lo tanto, menor o igual al n√∫mero m√°s peque√±o (70)." }, { text: "5", correct: false, explanation: "Incorrecto. 5 es un divisor com√∫n, pero no es el m√°ximo. 35 es m√°s grande." } ] },
            { question: "Dos corredores dan vueltas en una pista circular. Uno tarda 50 segundos por vuelta y el otro 60 segundos. Si parten juntos, ¬øcu√°ntos segundos pasar√°n hasta que se encuentren de nuevo en la l√≠nea de salida?", answers: [ { text: "10 segundos", correct: false, explanation: "Incorrecto. Este es el mcd de 50 y 60. El mcd no sirve para encontrar puntos de encuentro en el tiempo." }, { text: "300 segundos", correct: true, explanation: "¬°Correcto! Se busca una coincidencia en el futuro, por lo que calculamos el mcm. El mcm(50, 60) es 300 segundos." }, { text: "110 segundos", correct: false, explanation: "Incorrecto. Esto es la suma de los tiempos. La suma no indica una coincidencia de m√∫ltiplos." } ] },
            { question: "Se tienen tres cuerdas de 20, 30 y 42 metros. Se quieren cortar en trozos iguales y de la mayor longitud posible. ¬øCu√°ntos trozos se obtendr√°n en total?", answers: [ { text: "2 metros", correct: false, explanation: "Incorrecto. 2 metros es el mcd, que representa la longitud de cada trozo. La pregunta es por el n√∫mero total de trozos." }, { text: "46 trozos", correct: true, explanation: "¬°Correcto! Es un problema de dos pasos. El mcd(20, 30, 42) es 2 metros. Luego, se suman los trozos de cada cuerda: (20/2) + (30/2) + (42/2) = 10 + 15 + 21 = 46 trozos." }, { text: "92 trozos", correct: false, explanation: "Incorrecto. Esto es la suma de las longitudes. No representa el n√∫mero de trozos." } ] },
            { question: "El mcm de dos n√∫meros es 120 y su mcd es 4. Si uno de los n√∫meros es 24, ¬øcu√°l es el otro?", answers: [ { text: "480", correct: false, explanation: "Incorrecto. Este resultado proviene de multiplicar el mcm y el mcd, pero sin dividir por el n√∫mero conocido." }, { text: "20", correct: true, explanation: "¬°Correcto! Usando la propiedad a √ó b = mcm(a,b) √ó mcd(a,b), tenemos 24 √ó b = 120 √ó 4. Entonces, b = 480 / 24 = 20." }, { text: "30", correct: false, explanation: "Incorrecto. Si los n√∫meros fueran 24 y 30, su mcd ser√≠a 6 (no 4) y su mcm ser√≠a 120." } ] },
            { question: "Encuentre el n√∫mero m√°s peque√±o que al ser dividido por 3, 5 y 7 deja un residuo de 1.", answers: [ { text: "105", correct: false, explanation: "Incorrecto. 105 es el mcm de 3, 5 y 7. Se divide exactamente entre ellos, dejando residuo 0, no 1." }, { text: "106", correct: true, explanation: "¬°Correcto! Primero se calcula el mcm(3, 5, 7) = 105. Como siempre debe sobrar 1, se le suma al mcm: 105 + 1 = 106." }, { text: "22", correct: false, explanation: "Incorrecto. 22 dividido entre 3 deja residuo 1, pero dividido entre 5 deja residuo 2." } ] },
            { question: "El mcd de dos n√∫meros primos entre s√≠ es...", answers: [ { text: "0", correct: false, explanation: "Incorrecto. El mcd nunca es cero." }, { text: "El producto de los n√∫meros", correct: false, explanation: "Incorrecto. El producto de los n√∫meros es su mcm, no su mcd." }, { text: "1", correct: true, explanation: "¬°Correcto! Por definici√≥n, dos n√∫meros son primos entre s√≠ (o coprimos) si su √∫nico divisor com√∫n es 1. Por lo tanto, su mcd es 1." } ] },
            { question: "¬øCu√°l es el mcm de 16 y su doble, 32?", answers: [ { text: "16", correct: false, explanation: "Incorrecto. 16 es el mcd en este caso. El mcm no puede ser menor que el n√∫mero m√°s grande." }, { text: "32", correct: true, explanation: "¬°Correcto! Si un n√∫mero es m√∫ltiplo de otro, su mcm es el n√∫mero m√°s grande. 32 es m√∫ltiplo de 16, por lo que el mcm es 32." }, { text: "512", correct: false, explanation: "Incorrecto. Este es el producto de los dos n√∫meros. No es necesario multiplicar si uno es m√∫ltiplo del otro." } ] },
            { question: "Se quieren colocar 48 bol√≠grafos y 64 l√°pices en estuches, cada uno con el mismo n√∫mero de bol√≠grafos y l√°pices, y usando la mayor cantidad de estuches posible. ¬øCu√°ntos l√°pices habr√° en cada estuche?", answers: [ { text: "16", correct: false, explanation: "Incorrecto. 16 es el mcd, que representa el n√∫mero total de estuches a utilizar. La pregunta es por el n√∫mero de l√°pices." }, { text: "3", correct: false, explanation: "Incorrecto. Este es el n√∫mero de bol√≠grafos por estuche (48/16=3)." }, { text: "4", correct: true, explanation: "¬°Correcto! Primero, el mcd(48, 64) = 16 estuches. Luego, para saber los l√°pices por estuche, dividimos 64 / 16 = 4 l√°pices." } ] },
            { question: "Tres alarmas suenan cada 8, 10 y 15 minutos, respectivamente. Si suenan juntas al mediod√≠a, ¬øa qu√© hora volver√°n a sonar juntas?", answers: [ { text: "A las 12:40 p.m.", correct: false, explanation: "Incorrecto. 40 es el mcm de 8 y 10, pero no de 15." }, { text: "A la 1:00 p.m.", correct: false, explanation: "Incorrecto. Esto ser√≠a 60 minutos despu√©s. 60 es m√∫ltiplo de 10 y 15, pero no de 8." }, { text: "A las 2:00 p.m.", correct: true, explanation: "¬°Correcto! Se busca una coincidencia, por lo que se usa el mcm. El mcm(8, 10, 15) es 120 minutos, lo que equivale a 2 horas. Si sonaron a las 12:00 p.m., volver√°n a sonar a las 2:00 p.m." } ] },
            { question: "¬øCu√°l es el mcd de 1 y cualquier n√∫mero entero 'n'?", answers: [ { text: "n", correct: false, explanation: "Incorrecto. 'n' es divisor de 'n', pero no siempre es divisor de 1." }, { text: "1", correct: true, explanation: "¬°Correcto! El √∫nico divisor de 1 es 1. Como 1 divide a cualquier n√∫mero entero 'n', el m√°ximo com√∫n divisor es necesariamente 1." }, { text: "0", correct: false, explanation: "Incorrecto. El mcd no puede ser 0." } ] },
            { question: "Calcular el mcm de 2^3 * 3 y 2 * 3^2.", answers: [ { text: "2 * 3", correct: false, explanation: "Incorrecto. Esto es el mcd. Para el mcd se toman los factores comunes con el menor exponente." }, { text: "2^3 * 3^2", correct: true, explanation: "¬°Correcto! Para el mcm de n√∫meros descompuestos en factores primos, se toman todos los factores (comunes y no comunes) con su mayor exponente. En este caso, 2^3 y 3^2." }, { text: "2^4 * 3^3", correct: false, explanation: "Incorrecto. Se deben usar los exponentes presentes en los n√∫meros, no sumarlos." } ] },
            { question: "Un agricultor recoge 100 manzanas y 80 peras y quiere hacer cajas con el mismo contenido. ¬øCu√°l es el mayor n√∫mero de cajas que puede hacer?", answers: [ { text: "10", correct: false, explanation: "Incorrecto. 10 es un n√∫mero de cajas posible, pero no es el mayor. Se puede dividir en m√°s cajas." }, { text: "20", correct: true, explanation: "¬°Correcto! Se busca el mayor n√∫mero de cajas (grupos), lo que implica el mcd. El mcd(100, 80) es 20. Puede hacer 20 cajas." }, { text: "400", correct: false, explanation: "Incorrecto. Este es el mcm. No se puede hacer m√°s cajas que el n√∫mero de frutas." } ] }
        ];

        const motivationalTips = [
            "¬°Cada error es un paso m√°s cerca de la maestr√≠a!",
            "La pr√°ctica constante construye la confianza.",
            "¬°Sigue as√≠, lo est√°s haciendo genial!",
            "Analiza la pregunta, a veces la clave est√° en una sola palabra.",
            "Recuerda: MCD divide, MCM multiplica.",
            "¬°T√∫ puedes con esto y m√°s!",
            "La perseverancia es clave para el √©xito.",
            "Conf√≠a en tu proceso de aprendizaje."
        ];

        // Initialize QuizManager instance (will be available after module loads)
        let quizManager = null;

        // Initialize QuizManager when modules are loaded
        setTimeout(() => {
            if (window.QuizManager) {
                quizManager = new window.QuizManager();
                setupQuizCallbacks();
                console.log('‚úÖ QuizManager initialized successfully');
            }
        }, 100);

        // Gamification variables
        const userProfile = {
            name: 'Estudiante',
            level: 1,
            xp: 0,
            xpForNextLevel: 100,
            achievements: []
        };

        const achievements = [
            { id: 'FIRST_QUIZ', name: 'Rompiendo el Hielo', desc: 'Completa tu primer cuestionario.', unlocked: false },
            { id: 'STREAK_3', name: '¬°En Racha!', desc: 'Responde 3 preguntas seguidas correctamente.', unlocked: false },
            { id: 'MCM_MASTER', name: 'Maestro de M√∫ltiplos', desc: 'Responde 5 preguntas de MCM correctamente.', unlocked: false },
            { id: 'MCD_EXPERT', name: 'Experto Divisor', desc: 'Responde 5 preguntas de MCD correctamente.', unlocked: false },
            { id: 'SPEEDSTER', name: 'Velocista', desc: 'Responde una pregunta en menos de 15 segundos.', unlocked: false }
        ];
        
        // (JavaScript logic from previous context, with gamification integrated)
        let quizQuestions = [];
        let timePerQuestion = 90;
        let questionCount = 10;
        let questionOrder = 'random';
        
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const studyMaterialContainer = document.getElementById('study-material-container');
        const studyContent = document.getElementById('study-content');
        
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const nextButton = document.getElementById('next-button');
        const studyGuideBtn = document.getElementById('study-guide-btn');
        const viewProblemsBtn = document.getElementById('view-problems-btn');
        const viewSolutionsBtn = document.getElementById('view-solutions-btn');
        const viewReferencesBtn = document.getElementById('view-references-btn');
        const closeStudyBtn = document.getElementById('close-study-btn');
        
        const questionCountInput = document.getElementById('question-count');
        const timeLimitInput = document.getElementById('time-limit');
        const questionOrderInput = document.getElementById('question-order');

        const questionCounter = document.getElementById('question-counter');
        const scoreDisplay = document.getElementById('score');
        const questionText = document.getElementById('question-text');
        const answerButtons = document.querySelectorAll('.answer-btn');
        const feedbackText = document.getElementById('feedback-text');
        const finalScore = document.getElementById('final-score');
        const finalSummary = document.getElementById('final-summary');
        const timerBar = document.getElementById('timer-bar');
        const tipText = document.getElementById('tip-text');
        const xpGainText = document.getElementById('xp-gain-text');

        // Gamification UI
        const profileLevel = document.getElementById('profile-level');
        const profileName = document.getElementById('profile-name');
        const profileAchievements = document.getElementById('profile-achievements');
        const profileXpBar = document.getElementById('profile-xp-bar');
        const profileXpText = document.getElementById('profile-xp-text');
        const achievementNotification = document.getElementById('achievement-notification');
        const achievementTitle = document.getElementById('achievement-title');
        const achievementDesc = document.getElementById('achievement-desc');

        let timerInterval;
        let timeLeft;
        let currentQuestionIndex = 0;
        let score = 0;
        let correctStreak = 0;
        let mcmCorrect = 0;
        let mcdCorrect = 0;

        function updateProfileUI() {
            profileLevel.textContent = userProfile.level;
            profileName.textContent = userProfile.name;
            const unlockedCount = achievements.filter(a => a.unlocked).length;
            profileAchievements.textContent = `Logros: ${unlockedCount}/${achievements.length}`;
            const xpPercentage = (userProfile.xp / userProfile.xpForNextLevel) * 100;
            profileXpBar.style.width = `${xpPercentage}%`;
            profileXpText.textContent = `${userProfile.xp}/${userProfile.xpForNextLevel} XP`;
        }

        function addXP(amount) {
            userProfile.xp += amount;
            if (userProfile.xp >= userProfile.xpForNextLevel) {
                userProfile.level++;
                userProfile.xp -= userProfile.xpForNextLevel;
                userProfile.xpForNextLevel = Math.floor(userProfile.xpForNextLevel * 1.5);
                unlockAchievement('LEVEL_UP', `¬°Nuevo Nivel!`, `Alcanzaste el nivel ${userProfile.level}.`);
            }
            updateProfileUI();
        }

        function unlockAchievement(id, name, desc) {
            const achievement = achievements.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                showAchievementNotification(achievement.name, achievement.desc);
                updateProfileUI();
            } else if (!achievement) { // For custom one-time notifications like level up
                 showAchievementNotification(name, desc);
            }
        }
        
        function showAchievementNotification(name, desc) {
            achievementTitle.textContent = name;
            achievementDesc.textContent = desc;
            achievementNotification.classList.add('show');
            setTimeout(() => {
                achievementNotification.classList.remove('show');
            }, 4000);
        }

        function startGame() {
            if (!quizManager) {
                console.error('QuizManager not initialized yet');
                return;
            }

            questionCount = parseInt(questionCountInput.value, 10);
            timePerQuestion = parseInt(timeLimitInput.value, 10);
            questionOrder = questionOrderInput.value;

            if(isNaN(questionCount) || questionCount < 1 || questionCount > allQuestions.length) {
                questionCount = allQuestions.length;
                questionCountInput.value = questionCount;
            }
             if(isNaN(timePerQuestion) || timePerQuestion < 10) {
                timePerQuestion = 90;
                timeLimitInput.value = timePerQuestion;
            }

            // Configure QuizManager
            quizManager.configure({
                questionCount: questionCount,
                timeLimit: timePerQuestion,
                questionOrder: questionOrder
            });

            // Reset UI
            startScreen.classList.add('hidden');
            studyMaterialContainer.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            // Reset game state
            score = 0;
            correctStreak = 0;
            mcmCorrect = 0;
            mcdCorrect = 0;
            scoreDisplay.textContent = `Puntos: ${score}`;

            // Initialize quiz with QuizManager
            quizManager.initialize(allQuestions);
        }

        // showQuestion function is now handled by QuizManager callbacks
        // Keeping for compatibility but will be removed in future version

        function resetState() {
            answerButtons.forEach(button => {
                button.classList.remove('correct-answer', 'wrong-answer', 'disabled-button');
            });
            nextButton.classList.add('hidden');
            feedbackText.textContent = '';
            tipText.textContent = '';
        }
        
        // startTimer function is now handled by QuizManager
        // Timer updates come through onTimeUpdate callback
        
        // handleTimeOut is now handled by QuizManager through onAnswerSelected callback

        function selectAnswer(e) {
            if (!quizManager) {
                console.error('QuizManager not initialized');
                return;
            }

            const selectedButton = e.target;
            const answerIndex = Array.from(answerButtons).indexOf(selectedButton);

            // Clear existing timer and let QuizManager handle timing
            clearInterval(timerInterval);

            // Add visual feedback to selected button
            selectedButton.style.transform = 'scale(0.95)';
            setTimeout(() => {
                selectedButton.style.transform = '';
            }, 150);

            // Let QuizManager process the answer
            quizManager.selectAnswer(answerIndex);
        }
        
        function disableButtons() {
             answerButtons.forEach(button => {
                if (button.dataset.correct !== 'true' && !button.classList.contains('wrong-answer')) {
                    button.classList.add('wrong-answer');
                }
                button.classList.add('disabled-button');
            });
            nextButton.classList.remove('hidden');
        }

        function showCorrectAnswer() {
            answerButtons.forEach(button => {
                if (button.dataset.correct === 'true') {
                    button.classList.add('correct-answer');
                }
            });
        }
        
        // showNextQuestion is now handled by QuizManager.nextQuestion()
        
        function showResults() {
            unlockAchievement('FIRST_QUIZ');
            const bonusXP = 50;
            addXP(bonusXP);

            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            finalScore.textContent = score;
            const correctCount = score / 100;
            finalSummary.textContent = `Obtuviste ${correctCount} de ${quizQuestions.length} correctas.`;
            xpGainText.textContent = `+${(correctCount * 10) + bonusXP} XP ¬°Bono por completar!`;
        }

        // Setup callbacks for QuizManager integration
        function setupQuizCallbacks() {
            if (!quizManager) return;

            quizManager.setCallbacks({
                onQuestionChange: (data) => {
                    // Update UI with new question data
                    questionCounter.textContent = `${data.index + 1} de ${data.total}`;
                    questionText.textContent = data.question.question;
                    tipText.textContent = motivationalTips[Math.floor(Math.random() * motivationalTips.length)];

                    // Setup answer buttons
                    data.question.answers.forEach((answer, index) => {
                        const button = answerButtons[index];
                        button.textContent = answer.text;
                        button.dataset.correct = answer.correct;
                    });

                    resetState();
                },

                onScoreUpdate: (newScore, points) => {
                    score = newScore;
                    scoreElement.textContent = score;

                    // Add XP for gamification
                    addXP(Math.floor(points / 10));
                },

                onTimeUpdate: (timeRemaining, totalTime) => {
                    // Update timer bar
                    const percentage = (timeRemaining / totalTime) * 100;
                    timerBar.style.width = `${percentage}%`;
                },

                onAnswerSelected: (result) => {
                    // Show feedback
                    if (result.isCorrect) {
                        feedbackText.textContent = result.explanation;
                        feedbackText.classList.remove('text-red-500');
                        feedbackText.classList.add('text-green-400');
                    } else {
                        feedbackText.textContent = result.explanation;
                        feedbackText.classList.remove('text-green-400');
                        feedbackText.classList.add('text-red-500');
                    }

                    showCorrectAnswer();
                    disableButtons();

                    // Auto advance after 3 seconds
                    setTimeout(() => {
                        quizManager.nextQuestion();
                    }, 3000);
                },

                onQuizComplete: (stats) => {
                    // Show results using stats from QuizManager
                    unlockAchievement('FIRST_QUIZ');
                    const bonusXP = 50;
                    addXP(bonusXP);

                    quizScreen.classList.add('hidden');
                    resultsScreen.classList.remove('hidden');
                    finalScore.textContent = stats.finalScore;
                    finalSummary.textContent = `Obtuviste ${stats.correctAnswers} de ${stats.totalQuestions} correctas. Precisi√≥n: ${stats.accuracy}%`;
                    xpGainText.textContent = `+${(stats.correctAnswers * 10) + bonusXP} XP ¬°Bono por completar!`;
                }
            });
        }

        function showProblems() {
            let html = '<h2 class="text-3xl font-bold mb-4 text-center font-title">Banco de Problemas</h2>';
            allQuestions.forEach((q, index) => {
                html += `<div class="mb-4 p-2 border-b"><p class="font-bold">${index + 1}. ${q.question}</p></div>`;
            });
            studyContent.innerHTML = html;
            startScreen.classList.add('hidden');
            studyMaterialContainer.classList.remove('hidden');
        }

        function showSolutions() {
            let html = '<h2 class="text-3xl font-bold mb-6 text-center font-title">Solucionario Detallado</h2>';
            allQuestions.forEach((q, index) => {
                html += `<div class="mb-6 pb-4 border-b border-gray-300">
                            <p class="font-bold text-lg mb-3">${index + 1}. ${q.question}</p>
                            <ul>`;
                q.answers.forEach(ans => {
                    const bgColor = ans.correct ? 'bg-green-100 border-green-500' : 'bg-red-100 border-red-500';
                    const textColor = ans.correct ? 'text-green-800' : 'text-red-800';
                     html += `<li class="mb-2 p-3 rounded ${bgColor} border-l-4">
                                <strong class="${textColor}">${ans.text}</strong>
                                <p class="text-sm text-gray-700 mt-1">${ans.explanation}</p>
                              </li>`;
                });
                html += `</ul></div>`;
            });
            studyContent.innerHTML = html;
            startScreen.classList.add('hidden');
            studyMaterialContainer.classList.remove('hidden');
        }

        function showReferences() {
            let html = `
                <h2 class="text-3xl font-bold mb-6 text-center font-title">Referencias para Estudiar</h2>
                <div class="mb-8"><h3 class="text-2xl font-bold mb-3 text-purple-800 border-b-2 border-purple-200 pb-2 font-title">Videos de YouTube</h3><ul class="list-disc list-inside space-y-2">
                    <li><a href="https://youtu.be/2Pxsm91QiRU?si=jpnrRWFNTuftDtYE" target="_blank" class="text-blue-600 hover:underline">Diferencias entre el mcd y el mcm por Daniel Carre√≥n</a></li>
                    <li><a href="https://www.youtube.com/watch?v=W3g4QxlN4xQ&list=PLeySRPnY35dGfGMTx3uJ_v1Q9ccLbZYNp" target="_blank" class="text-blue-600 hover:underline">Lista de reproducci√≥n del tema por profe Alex</a></li>
                    <li><a href="https://youtu.be/FiopqzCb2LI?si=rr-nG_0AXL6jTcmI" target="_blank" class="text-blue-600 hover:underline">MCM por Math2me</a></li>
                </ul></div>
                <div class="mb-8"><h3 class="text-2xl font-bold mb-3 text-purple-800 border-b-2 border-purple-200 pb-2 font-title">Plataformas Educativas</h3><ul class="list-disc list-inside space-y-2">
                    <li><a href="https://es.khanacademy.org/math/pre-algebra/pre-algebra-factors-multiples/pre-algebra-greatest-common-divisor/v/greatest-common-divisor" target="_blank" class="text-blue-600 hover:underline">Khan Academy: M√°ximo Com√∫n Divisor (Lecci√≥n y videos)</a></li>
                    <li><a href="https://es.khanacademy.org/math/pre-algebra/pre-algebra-factors-multiples/pre-algebra-least-common-multiple/v/least-common-multiple-exercise" target="_blank" class="text-blue-600 hover:underline">Khan Academy: M√≠nimo Com√∫n M√∫ltiplo (Lecci√≥n y videos)</a></li>
                </ul></div>
                <div><h3 class="text-2xl font-bold mb-3 text-purple-800 border-b-2 border-purple-200 pb-2 font-title">Bibliograf√≠a</h3><ul class="list-disc list-inside space-y-2">
                    <li><strong>√Ålgebra de Baldor</strong> por Aurelio Baldor: Un cl√°sico fundamental para el √°lgebra preuniversitaria. Los cap√≠tulos sobre divisibilidad, mcd y mcm son muy completos y contienen numerosos ejercicios.</li>
                    <li><strong>Aritm√©tica Te√≥rico-Pr√°ctica</strong> por A. Baldor: Complemento del anterior, enfocado en los fundamentos num√©ricos. Explica los conceptos de m√∫ltiplos y divisores con gran detalle.</li>
                    <li><strong>Pre√°lgebra</strong> por OpenStax (disponible gratis en l√≠nea): Un recurso moderno y accesible que cubre todos los temas fundamentales, incluyendo factores y m√∫ltiplos, con un enfoque claro y pr√°ctico.</li>
                </ul></div>`;
            studyContent.innerHTML = html;
            startScreen.classList.add('hidden');
            studyMaterialContainer.classList.remove('hidden');
        }

        function showStudyGuide() {
            let html = `
                <div class="glass-strong modern-card text-white mb-8">
                    <h2 class="text-4xl font-bold mb-6 text-center font-title neon-glow">
                        <i class="fas fa-graduation-cap mr-3 text-blue-300"></i>
                        Gu√≠a Completa: MCM y MCD
                    </h2>
                    <p class="text-xl text-center text-blue-200 font-semibold">
                        üéØ Domina los conceptos para el EXANI-II de CUPREX
                    </p>
                </div>

                <div class="space-y-8">
                    <!-- Secci√≥n 1: Fundamentos -->
                    <div class="glass modern-card hover-lift step-item">
                        <h3 class="text-3xl font-bold mb-4 text-purple-300 font-title flex items-center">
                            <i class="fas fa-cube mr-3"></i>
                            1. Fundamentos B√°sicos
                        </h3>
                        <div class="space-y-4 text-lg">
                            <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-4 rounded-xl border border-purple-300/30">
                                <h4 class="font-bold text-xl mb-2 text-yellow-300">üîç ¬øQu√© son los n√∫meros primos?</h4>
                                <p class="mb-3">Son n√∫meros especiales que solo pueden dividirse exactamente entre <strong>1</strong> y <strong>ellos mismos</strong>.</p>
                                <div class="bg-black/30 p-3 rounded-lg font-mono text-green-300">
                                    Ejemplos: 2, 3, 5, 7, 11, 13, 17, 19, 23...
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-blue-500/20 to-cyan-500/20 p-4 rounded-xl border border-blue-300/30">
                                <h4 class="font-bold text-xl mb-2 text-yellow-300">‚ö° Descomposici√≥n en factores primos</h4>
                                <p class="mb-3">Es como "desarmar" un n√∫mero en sus piezas m√°s b√°sicas (n√∫meros primos).</p>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <p class="text-center font-bold text-blue-300 mb-2">Ejemplo: Descomponer 24</p>
                                        <div class="font-mono text-green-300 text-center">
                                            24 ‚îÇ 2<br>
                                            12 ‚îÇ 2<br>
                                            6  ‚îÇ 2<br>
                                            3  ‚îÇ 3<br>
                                            1  ‚îÇ
                                        </div>
                                        <p class="text-center mt-2 font-bold">24 = 2¬≥ √ó 3¬π</p>
                                    </div>
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <p class="text-center font-bold text-blue-300 mb-2">Ejemplo: Descomponer 30</p>
                                        <div class="font-mono text-green-300 text-center">
                                            30 ‚îÇ 2<br>
                                            15 ‚îÇ 3<br>
                                            5  ‚îÇ 5<br>
                                            1  ‚îÇ
                                        </div>
                                        <p class="text-center mt-2 font-bold">30 = 2¬π √ó 3¬π √ó 5¬π</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n 2: MCD -->
                    <div class="glass modern-card hover-lift step-item">
                        <h3 class="text-3xl font-bold mb-4 text-green-300 font-title flex items-center">
                            <i class="fas fa-divide mr-3"></i>
                            2. M√°ximo Com√∫n Divisor (MCD)
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-4 rounded-xl border border-green-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üéØ ¬øQu√© es el MCD?</h4>
                                <p class="text-lg mb-3">Es el <strong>n√∫mero m√°s grande</strong> que puede dividir exactamente a dos o m√°s n√∫meros.</p>
                                <div class="bg-black/30 p-3 rounded-lg">
                                    <p class="text-center font-bold text-blue-300">üí° Pi√©nsalo as√≠:</p>
                                    <p class="text-center">"¬øCu√°l es el trozo M√ÅS GRANDE en que puedo dividir estos n√∫meros?"</p>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-4 rounded-xl border border-cyan-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üìù M√©todo para calcular MCD:</h4>
                                <ol class="list-decimal list-inside space-y-2 text-lg">
                                    <li>Descomp√≥n cada n√∫mero en factores primos</li>
                                    <li>Identifica los factores <strong>comunes</strong> a todos</li>
                                    <li>Toma el <strong>menor exponente</strong> de cada factor com√∫n</li>
                                    <li>Multiplica estos factores</li>
                                </ol>
                            </div>

                            <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-4 rounded-xl border border-purple-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üî• Cu√°ndo usar MCD - Palabras Clave:</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <h5 class="font-bold text-red-300 mb-2">Verbos de acci√≥n:</h5>
                                        <ul class="text-green-300">
                                            <li>‚Ä¢ Dividir, cortar, repartir</li>
                                            <li>‚Ä¢ Separar, partir, fraccionar</li>
                                        </ul>
                                    </div>
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <h5 class="font-bold text-red-300 mb-2">Palabras descriptivas:</h5>
                                        <ul class="text-green-300">
                                            <li>‚Ä¢ Mayor/m√°ximo tama√±o</li>
                                            <li>‚Ä¢ Lo m√°s grande posible</li>
                                            <li>‚Ä¢ Grupos iguales</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n 3: MCM -->
                    <div class="glass modern-card hover-lift step-item">
                        <h3 class="text-3xl font-bold mb-4 text-blue-300 font-title flex items-center">
                            <i class="fas fa-arrows-repeat mr-3"></i>
                            3. M√≠nimo Com√∫n M√∫ltiplo (MCM)
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-blue-500/20 to-indigo-500/20 p-4 rounded-xl border border-blue-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üéØ ¬øQu√© es el MCM?</h4>
                                <p class="text-lg mb-3">Es el <strong>n√∫mero m√°s peque√±o</strong> que es m√∫ltiplo de dos o m√°s n√∫meros.</p>
                                <div class="bg-black/30 p-3 rounded-lg">
                                    <p class="text-center font-bold text-blue-300">üí° Pi√©nsalo as√≠:</p>
                                    <p class="text-center">"¬øCu√°ndo volver√°n a COINCIDIR estos eventos?"</p>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-pink-500/20 to-red-500/20 p-4 rounded-xl border border-pink-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üìù M√©todo para calcular MCM:</h4>
                                <ol class="list-decimal list-inside space-y-2 text-lg">
                                    <li>Descomp√≥n cada n√∫mero en factores primos</li>
                                    <li>Toma <strong>todos</strong> los factores (comunes y no comunes)</li>
                                    <li>Usa el <strong>mayor exponente</strong> de cada factor</li>
                                    <li>Multiplica estos factores</li>
                                </ol>
                            </div>

                            <div class="bg-gradient-to-r from-orange-500/20 to-yellow-500/20 p-4 rounded-xl border border-orange-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üî• Cu√°ndo usar MCM - Palabras Clave:</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <h5 class="font-bold text-red-300 mb-2">Conceptos de tiempo:</h5>
                                        <ul class="text-green-300">
                                            <li>‚Ä¢ Coincidir, encontrarse</li>
                                            <li>‚Ä¢ La pr√≥xima vez que...</li>
                                            <li>‚Ä¢ Volver a repetirse</li>
                                        </ul>
                                    </div>
                                    <div class="bg-black/30 p-3 rounded-lg">
                                        <h5 class="font-bold text-red-300 mb-2">Conceptos de tama√±o:</h5>
                                        <ul class="text-green-300">
                                            <li>‚Ä¢ Menor/m√≠nimo n√∫mero</li>
                                            <li>‚Ä¢ La primera vez</li>
                                            <li>‚Ä¢ El m√°s peque√±o</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n 4: Estrategias -->
                    <div class="glass modern-card hover-lift step-item">
                        <h3 class="text-3xl font-bold mb-4 text-yellow-300 font-title flex items-center">
                            <i class="fas fa-lightbulb mr-3"></i>
                            4. Estrategias para el EXANI-II
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-4 rounded-xl border border-yellow-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üéØ Reglas de Oro:</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-black/30 p-3 rounded-lg border border-green-300/30">
                                        <h5 class="font-bold text-green-300 mb-2">‚úÖ Para MCD:</h5>
                                        <ul class="text-white space-y-1">
                                            <li>‚Ä¢ Nunca es mayor que el n√∫mero m√°s peque√±o</li>
                                            <li>‚Ä¢ Se usa para "dividir" o "repartir"</li>
                                            <li>‚Ä¢ Busca el tama√±o m√°ximo de grupos</li>
                                        </ul>
                                    </div>
                                    <div class="bg-black/30 p-3 rounded-lg border border-blue-300/30">
                                        <h5 class="font-bold text-blue-300 mb-2">‚úÖ Para MCM:</h5>
                                        <ul class="text-white space-y-1">
                                            <li>‚Ä¢ Nunca es menor que el n√∫mero m√°s grande</li>
                                            <li>‚Ä¢ Se usa para "coincidir" o "repetir"</li>
                                            <li>‚Ä¢ Busca cu√°ndo se encuentran</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-red-500/20 to-pink-500/20 p-4 rounded-xl border border-red-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">‚ö†Ô∏è Trampas Comunes:</h4>
                                <ul class="space-y-2 text-lg">
                                    <li class="flex items-start">
                                        <span class="text-red-400 mr-2">1.</span>
                                        <span><strong>Preguntas de 2 pasos:</strong> A veces te piden el n√∫mero de grupos, no el tama√±o del grupo</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-red-400 mr-2">2.</span>
                                        <span><strong>Confundir tiempo:</strong> Te piden la hora exacta, no solo los minutos</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-red-400 mr-2">3.</span>
                                        <span><strong>N√∫meros primos:</strong> Si dos n√∫meros son primos entre s√≠, MCD = 1 y MCM = su producto</span>
                                    </li>
                                </ul>
                            </div>

                            <div class="bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-xl border border-green-300/30">
                                <h4 class="font-bold text-xl text-yellow-300 mb-3">üî• F√≥rmula M√°gica:</h4>
                                <div class="bg-black/30 p-4 rounded-lg text-center">
                                    <p class="text-2xl font-bold text-blue-300 mb-2">A √ó B = MCD(A,B) √ó MCM(A,B)</p>
                                    <p class="text-sm text-gray-300">Esta f√≥rmula te puede salvar en el examen</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n para ejercicios -->
                    <div class="text-center">
                        <button id="show-exercises-btn" class="btn-modern text-2xl font-bold py-4 px-8 animate-glow">
                            <i class="fas fa-dumbbell mr-3"></i>
                            Ver Ejercicios Paso a Paso
                        </button>
                    </div>
                </div>
            `;
            studyContent.innerHTML = html;
            startScreen.classList.add('hidden');
            studyMaterialContainer.classList.remove('hidden');

            // Add animation reveal effect
            setTimeout(() => {
                const stepItems = document.querySelectorAll('.step-item');
                stepItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('revealed');
                    }, index * 200);
                });
            }, 100);

            // Add exercise button event
            document.getElementById('show-exercises-btn').addEventListener('click', showExercises);

            // Re-render MathJax content
            if (typeof MathJax !== 'undefined') MathJax.typeset();
        }

        function showExercises() {
            let html = `
                <div class="glass-strong modern-card text-white mb-8">
                    <h2 class="text-4xl font-bold mb-6 text-center font-title neon-glow">
                        <i class="fas fa-dumbbell mr-3 text-orange-300"></i>
                        5 Ejercicios Paso a Paso
                    </h2>
                    <p class="text-xl text-center text-blue-200 font-semibold">
                        üéØ Domina la t√©cnica con ejemplos reales del EXANI-II
                    </p>
                    <div class="text-center mt-4">
                        <button id="back-to-guide-btn" class="glass modern-card px-6 py-2 hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Volver a la Gu√≠a
                        </button>
                    </div>
                </div>

                <div class="space-y-12">
                    <!-- Ejercicio 1: MCD B√°sico -->
                    <div class="glass modern-card hover-lift exercise-card">
                        <h3 class="text-3xl font-bold mb-6 text-green-300 font-title flex items-center">
                            <span class="bg-gradient-to-r from-green-400 to-blue-500 text-black rounded-full w-12 h-12 flex items-center justify-center mr-4 text-2xl font-black">1</span>
                            MCD - Problema de Divisi√≥n
                        </h3>

                        <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-6 rounded-xl border border-yellow-300/30 mb-6">
                            <h4 class="text-2xl font-bold text-yellow-300 mb-4 flex items-center">
                                <i class="fas fa-question-circle mr-3"></i>
                                Problema:
                            </h4>
                            <p class="text-xl leading-relaxed">
                                Un carpintero quiere cortar dos listones de madera de <strong>48 cm</strong> y <strong>72 cm</strong>
                                en trozos de igual longitud, <strong>lo m√°s largos posible</strong>. ¬øCu√°l debe ser la longitud de cada trozo?
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div class="step-container">
                                <h5 class="text-xl font-bold text-blue-300 mb-4 flex items-center step-title" data-step="1">
                                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                                    Identificar qu√© operaci√≥n usar
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-blue-300/30" data-step="1" style="display: none;">
                                    <p class="mb-3"><strong>Palabras clave:</strong> "cortar", "lo m√°s largos posible"</p>
                                    <p class="mb-3">üéØ <strong>Necesitamos MCD</strong> porque queremos dividir en trozos del mayor tama√±o posible.</p>
                                    <div class="bg-green-500/20 p-3 rounded-lg">
                                        <p class="font-bold">‚úÖ Regla: MCD se usa para DIVIDIR en partes lo M√ÅS GRANDES posible</p>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-blue-300 mb-4 flex items-center step-title" data-step="2">
                                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                                    Descomponer en factores primos
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-blue-300/30" data-step="2" style="display: none;">
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="bg-purple-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-purple-300">Descomponer 48</h6>
                                            <div class="font-mono text-green-300 text-center text-lg leading-relaxed">
                                                48 ‚îÇ 2<br>
                                                24 ‚îÇ 2<br>
                                                12 ‚îÇ 2<br>
                                                6  ‚îÇ 2<br>
                                                3  ‚îÇ 3<br>
                                                1  ‚îÇ
                                            </div>
                                            <p class="text-center mt-3 font-bold text-xl">48 = 2‚Å¥ √ó 3¬π</p>
                                        </div>
                                        <div class="bg-indigo-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-indigo-300">Descomponer 72</h6>
                                            <div class="font-mono text-green-300 text-center text-lg leading-relaxed">
                                                72 ‚îÇ 2<br>
                                                36 ‚îÇ 2<br>
                                                18 ‚îÇ 2<br>
                                                9  ‚îÇ 3<br>
                                                3  ‚îÇ 3<br>
                                                1  ‚îÇ
                                            </div>
                                            <p class="text-center mt-3 font-bold text-xl">72 = 2¬≥ √ó 3¬≤</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-blue-300 mb-4 flex items-center step-title" data-step="3">
                                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                                    Aplicar regla del MCD
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-blue-300/30" data-step="3" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg">Para MCD: <strong>factores comunes con menor exponente</strong></p>
                                        <div class="bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-4 rounded-lg">
                                            <p class="mb-2">48 = <span class="text-yellow-300">2‚Å¥</span> √ó <span class="text-green-300">3¬π</span></p>
                                            <p class="mb-4">72 = <span class="text-yellow-300">2¬≥</span> √ó <span class="text-green-300">3¬≤</span></p>
                                            <p class="font-bold text-red-300">Factores comunes: 2 y 3</p>
                                            <p class="font-bold text-yellow-300">Menores exponentes: 2¬≥ y 3¬π</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-blue-300 mb-4 flex items-center step-title" data-step="4">
                                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                    Calcular el resultado
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-blue-300/30" data-step="4" style="display: none;">
                                    <div class="text-center">
                                        <div class="bg-gradient-to-r from-green-500/30 to-emerald-500/30 p-6 rounded-xl border border-green-300/50">
                                            <p class="text-2xl mb-4">MCD(48, 72) = 2¬≥ √ó 3¬π</p>
                                            <p class="text-2xl mb-4">= 8 √ó 3</p>
                                            <p class="text-4xl font-bold text-green-300">= 24 cm</p>
                                        </div>
                                        <div class="mt-4 bg-blue-500/20 p-4 rounded-lg">
                                            <p class="font-bold text-yellow-300">‚úÖ Respuesta: Cada trozo debe medir 24 cm</p>
                                            <p class="text-sm text-gray-300">Verificaci√≥n: 48√∑24=2 trozos, 72√∑24=3 trozos</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-6">
                                <button class="btn-modern text-lg py-3 px-8 exercise-btn" data-exercise="1">
                                    <i class="fas fa-play mr-2"></i>
                                    Mostrar Soluci√≥n Paso a Paso
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ejercicio 2: MCM B√°sico -->
                    <div class="glass modern-card hover-lift exercise-card">
                        <h3 class="text-3xl font-bold mb-6 text-blue-300 font-title flex items-center">
                            <span class="bg-gradient-to-r from-blue-400 to-purple-500 text-black rounded-full w-12 h-12 flex items-center justify-center mr-4 text-2xl font-black">2</span>
                            MCM - Problema de Coincidencia
                        </h3>

                        <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 p-6 rounded-xl border border-blue-300/30 mb-6">
                            <h4 class="text-2xl font-bold text-blue-300 mb-4 flex items-center">
                                <i class="fas fa-clock mr-3"></i>
                                Problema:
                            </h4>
                            <p class="text-xl leading-relaxed">
                                Dos autobuses salen de la terminal. Uno regresa cada <strong>15 minutos</strong> y
                                otro cada <strong>20 minutos</strong>. Si salieron juntos a las 8:00 AM,
                                ¬øa qu√© hora volver√°n a <strong>coincidir</strong> en la terminal?
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div class="step-container">
                                <h5 class="text-xl font-bold text-purple-300 mb-4 flex items-center step-title" data-step="5">
                                    <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                                    Identificar qu√© operaci√≥n usar
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-purple-300/30" data-step="5" style="display: none;">
                                    <p class="mb-3"><strong>Palabras clave:</strong> "coincidir", "volver√°n a"</p>
                                    <p class="mb-3">üéØ <strong>Necesitamos MCM</strong> porque buscamos cu√°ndo se encuentran de nuevo.</p>
                                    <div class="bg-blue-500/20 p-3 rounded-lg">
                                        <p class="font-bold">‚úÖ Regla: MCM se usa para encontrar COINCIDENCIAS en el tiempo</p>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-purple-300 mb-4 flex items-center step-title" data-step="6">
                                    <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                                    Descomponer en factores primos
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-purple-300/30" data-step="6" style="display: none;">
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="bg-green-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-green-300">Descomponer 15</h6>
                                            <div class="font-mono text-green-300 text-center text-lg leading-relaxed">
                                                15 ‚îÇ 3<br>
                                                5  ‚îÇ 5<br>
                                                1  ‚îÇ
                                            </div>
                                            <p class="text-center mt-3 font-bold text-xl">15 = 3¬π √ó 5¬π</p>
                                        </div>
                                        <div class="bg-orange-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-orange-300">Descomponer 20</h6>
                                            <div class="font-mono text-green-300 text-center text-lg leading-relaxed">
                                                20 ‚îÇ 2<br>
                                                10 ‚îÇ 2<br>
                                                5  ‚îÇ 5<br>
                                                1  ‚îÇ
                                            </div>
                                            <p class="text-center mt-3 font-bold text-xl">20 = 2¬≤ √ó 5¬π</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-purple-300 mb-4 flex items-center step-title" data-step="7">
                                    <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                                    Aplicar regla del MCM
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-purple-300/30" data-step="7" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg">Para MCM: <strong>todos los factores con mayor exponente</strong></p>
                                        <div class="bg-gradient-to-r from-pink-500/20 to-red-500/20 p-4 rounded-lg">
                                            <p class="mb-2">15 = <span class="text-yellow-300">3¬π</span> √ó <span class="text-green-300">5¬π</span></p>
                                            <p class="mb-4">20 = <span class="text-blue-300">2¬≤</span> √ó <span class="text-green-300">5¬π</span></p>
                                            <p class="font-bold text-red-300">Todos los factores: 2, 3, 5</p>
                                            <p class="font-bold text-yellow-300">Mayores exponentes: 2¬≤, 3¬π, 5¬π</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-purple-300 mb-4 flex items-center step-title" data-step="8">
                                    <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                    Calcular y convertir a tiempo
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-purple-300/30" data-step="8" style="display: none;">
                                    <div class="text-center space-y-4">
                                        <div class="bg-gradient-to-r from-blue-500/30 to-purple-500/30 p-6 rounded-xl border border-blue-300/50">
                                            <p class="text-2xl mb-4">MCM(15, 20) = 2¬≤ √ó 3¬π √ó 5¬π</p>
                                            <p class="text-2xl mb-4">= 4 √ó 3 √ó 5</p>
                                            <p class="text-4xl font-bold text-blue-300">= 60 minutos</p>
                                        </div>
                                        <div class="bg-green-500/20 p-4 rounded-lg">
                                            <p class="font-bold text-yellow-300">‚úÖ Coincidir√°n cada 60 minutos (1 hora)</p>
                                            <p class="text-2xl font-bold text-green-300">Respuesta: 9:00 AM</p>
                                            <p class="text-sm text-gray-300">8:00 AM + 1 hora = 9:00 AM</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-6">
                                <button class="btn-modern text-lg py-3 px-8 exercise-btn" data-exercise="2">
                                    <i class="fas fa-play mr-2"></i>
                                    Mostrar Soluci√≥n Paso a Paso
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ejercicio 3: Problema Mixto -->
                    <div class="glass modern-card hover-lift exercise-card">
                        <h3 class="text-3xl font-bold mb-6 text-orange-300 font-title flex items-center">
                            <span class="bg-gradient-to-r from-orange-400 to-red-500 text-black rounded-full w-12 h-12 flex items-center justify-center mr-4 text-2xl font-black">3</span>
                            Problema de 2 Pasos - MCD + C√°lculo
                        </h3>

                        <div class="bg-gradient-to-r from-orange-500/20 to-red-500/20 p-6 rounded-xl border border-orange-300/30 mb-6">
                            <h4 class="text-2xl font-bold text-orange-300 mb-4 flex items-center">
                                <i class="fas fa-boxes mr-3"></i>
                                Problema:
                            </h4>
                            <p class="text-xl leading-relaxed">
                                Se tienen <strong>48 bol√≠grafos</strong> y <strong>64 l√°pices</strong>. Se quieren armar estuches
                                con la misma cantidad de cada art√≠culo, usando la <strong>mayor cantidad de estuches posible</strong>.
                                ¬øCu√°ntos <strong>l√°pices habr√° en cada estuche</strong>?
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div class="step-container">
                                <h5 class="text-xl font-bold text-orange-300 mb-4 flex items-center step-title" data-step="9">
                                    <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                                    Identificar qu√© necesitamos
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-orange-300/30" data-step="9" style="display: none;">
                                    <div class="space-y-3">
                                        <p class="mb-3"><strong>Palabras clave:</strong> "mayor cantidad de estuches posible"</p>
                                        <p class="mb-3">üéØ <strong>Paso 1:</strong> MCD para encontrar el n√∫mero de estuches</p>
                                        <p class="mb-3">üéØ <strong>Paso 2:</strong> Dividir l√°pices entre n√∫mero de estuches</p>
                                        <div class="bg-red-500/20 p-3 rounded-lg">
                                            <p class="font-bold">‚ö†Ô∏è ¬°Cuidado! No pide el MCD directamente, sino los l√°pices por estuche</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-orange-300 mb-4 flex items-center step-title" data-step="10">
                                    <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                                    Calcular MCD(48, 64)
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-orange-300/30" data-step="10" style="display: none;">
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="bg-blue-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-blue-300">48 = 2‚Å¥ √ó 3¬π</h6>
                                        </div>
                                        <div class="bg-purple-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-purple-300">64 = 2‚Å∂</h6>
                                        </div>
                                    </div>
                                    <div class="mt-4 bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-lg text-center">
                                        <p class="text-xl mb-2">Factor com√∫n: 2</p>
                                        <p class="text-xl mb-2">Menor exponente: 2‚Å¥</p>
                                        <p class="text-2xl font-bold text-green-300">MCD = 2‚Å¥ = 16 estuches</p>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-orange-300 mb-4 flex items-center step-title" data-step="11">
                                    <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                                    Calcular l√°pices por estuche
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-orange-300/30" data-step="11" style="display: none;">
                                    <div class="text-center">
                                        <div class="bg-gradient-to-r from-purple-500/30 to-pink-500/30 p-6 rounded-xl border border-purple-300/50">
                                            <p class="text-2xl mb-4">L√°pices por estuche = Total de l√°pices √∑ N√∫mero de estuches</p>
                                            <p class="text-2xl mb-4">= 64 √∑ 16</p>
                                            <p class="text-4xl font-bold text-purple-300">= 4 l√°pices por estuche</p>
                                        </div>
                                        <div class="mt-4 bg-green-500/20 p-4 rounded-lg">
                                            <p class="font-bold text-yellow-300">‚úÖ Respuesta: 4 l√°pices en cada estuche</p>
                                            <p class="text-sm text-gray-300">Verificaci√≥n: 16 estuches √ó 4 l√°pices = 64 l√°pices ‚úì</p>
                                            <p class="text-sm text-gray-300">Tambi√©n: 16 estuches √ó 3 bol√≠grafos = 48 bol√≠grafos ‚úì</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-orange-300 mb-4 flex items-center step-title" data-step="12">
                                    <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                    Verificaci√≥n completa del problema
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-orange-300/30" data-step="12" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg text-center">Vamos a verificar que todos los requisitos se cumplen:</p>
                                        <div class="bg-gradient-to-r from-blue-500/20 to-indigo-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-blue-300">Requisitos del problema:</h6>
                                            <p class="mb-2">‚úÖ Mismo n√∫mero de art√≠culos en cada estuche</p>
                                            <p class="mb-2">‚úÖ Mayor cantidad de estuches posible (16 es el MCD)</p>
                                            <p class="mb-2">‚úÖ Se usan todos los art√≠culos sin desperdiciar</p>
                                        </div>
                                        <div class="bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-lg text-center">
                                            <p class="text-xl font-bold mb-2">Resultado final:</p>
                                            <p class="text-lg">üì¶ 16 estuches</p>
                                            <p class="text-lg">‚úèÔ∏è 3 bol√≠grafos por estuche</p>
                                            <p class="text-lg">‚úèÔ∏è 4 l√°pices por estuche</p>
                                            <p class="font-bold text-green-300 mt-2">¬°Problema resuelto perfectamente!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-6">
                                <button class="btn-modern text-lg py-3 px-8 exercise-btn" data-exercise="3">
                                    <i class="fas fa-play mr-2"></i>
                                    Mostrar Soluci√≥n Paso a Paso
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ejercicio 4: N√∫meros primos entre s√≠ -->
                    <div class="glass modern-card hover-lift exercise-card">
                        <h3 class="text-3xl font-bold mb-6 text-pink-300 font-title flex items-center">
                            <span class="bg-gradient-to-r from-pink-400 to-purple-500 text-black rounded-full w-12 h-12 flex items-center justify-center mr-4 text-2xl font-black">4</span>
                            N√∫meros Primos Entre S√≠
                        </h3>

                        <div class="bg-gradient-to-r from-pink-500/20 to-purple-500/20 p-6 rounded-xl border border-pink-300/30 mb-6">
                            <h4 class="text-2xl font-bold text-pink-300 mb-4 flex items-center">
                                <i class="fas fa-star mr-3"></i>
                                Problema:
                            </h4>
                            <p class="text-xl leading-relaxed">
                                ¬øCu√°l es el MCM de dos n√∫meros primos diferentes, como <strong>7 y 13</strong>?
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div class="step-container">
                                <h5 class="text-xl font-bold text-pink-300 mb-4 flex items-center step-title" data-step="13">
                                    <span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                                    Reconocer n√∫meros primos entre s√≠
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-pink-300/30" data-step="13" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg">Dos n√∫meros son <strong>primos entre s√≠</strong> cuando su √∫nico divisor com√∫n es 1.</p>
                                        <div class="bg-gradient-to-r from-blue-500/20 to-cyan-500/20 p-4 rounded-lg">
                                            <p class="mb-2"><strong>7:</strong> Es primo (solo divisible entre 1 y 7)</p>
                                            <p class="mb-2"><strong>13:</strong> Es primo (solo divisible entre 1 y 13)</p>
                                            <p class="font-bold text-cyan-300">üîç No comparten factores excepto el 1</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-pink-300 mb-4 flex items-center step-title" data-step="14">
                                    <span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                                    Aplicar regla especial
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-pink-300/30" data-step="14" style="display: none;">
                                    <div class="space-y-4">
                                        <div class="bg-gradient-to-r from-yellow-500/30 to-orange-500/30 p-6 rounded-xl border border-yellow-300/50 text-center">
                                            <h6 class="text-xl font-bold text-yellow-300 mb-4">üî• Regla de Oro para N√∫meros Primos</h6>
                                            <p class="text-lg mb-4">Si dos n√∫meros son primos entre s√≠:</p>
                                            <div class="space-y-2">
                                                <p class="text-xl"><strong>MCD = 1</strong></p>
                                                <p class="text-xl"><strong>MCM = A √ó B</strong></p>
                                            </div>
                                        </div>
                                        <div class="bg-green-500/20 p-4 rounded-lg text-center">
                                            <p class="text-2xl font-bold text-green-300">MCM(7, 13) = 7 √ó 13 = 91</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-pink-300 mb-4 flex items-center step-title" data-step="15">
                                    <span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                                    Verificar que son primos entre s√≠
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-pink-300/30" data-step="15" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg">Verificamos que 7 y 13 efectivamente no comparten factores:</p>
                                        <div class="grid md:grid-cols-2 gap-6">
                                            <div class="bg-blue-500/20 p-4 rounded-lg">
                                                <h6 class="font-bold text-center mb-3 text-blue-300">Factores de 7</h6>
                                                <div class="text-center">
                                                    <p class="mb-2">7 es primo</p>
                                                    <p class="font-bold text-green-300">Factores: 1, 7</p>
                                                </div>
                                            </div>
                                            <div class="bg-purple-500/20 p-4 rounded-lg">
                                                <h6 class="font-bold text-center mb-3 text-purple-300">Factores de 13</h6>
                                                <div class="text-center">
                                                    <p class="mb-2">13 es primo</p>
                                                    <p class="font-bold text-green-300">Factores: 1, 13</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-lg text-center">
                                            <p class="font-bold text-yellow-300">‚úÖ Factor com√∫n: solo el 1</p>
                                            <p class="text-sm">Por lo tanto, MCD(7, 13) = 1</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-pink-300 mb-4 flex items-center step-title" data-step="16">
                                    <span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                    Calcular el MCM directamente
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-pink-300/30" data-step="16" style="display: none;">
                                    <div class="text-center">
                                        <div class="bg-gradient-to-r from-orange-500/30 to-red-500/30 p-6 rounded-xl border border-orange-300/50">
                                            <p class="text-2xl mb-4">Como son primos entre s√≠:</p>
                                            <p class="text-2xl mb-4">MCM(7, 13) = 7 √ó 13</p>
                                            <p class="text-4xl font-bold text-orange-300">= 91</p>
                                        </div>
                                        <div class="mt-4 bg-green-500/20 p-4 rounded-lg">
                                            <p class="font-bold text-yellow-300">‚úÖ Respuesta: MCM(7, 13) = 91</p>
                                            <p class="text-sm text-gray-300">Verificaci√≥n: 91 √∑ 7 = 13 ‚úì, 91 √∑ 13 = 7 ‚úì</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-6">
                                <button class="btn-modern text-lg py-3 px-8 exercise-btn" data-exercise="4">
                                    <i class="fas fa-play mr-2"></i>
                                    Mostrar Soluci√≥n Paso a Paso
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ejercicio 5: F√≥rmula m√°gica -->
                    <div class="glass modern-card hover-lift exercise-card">
                        <h3 class="text-3xl font-bold mb-6 text-cyan-300 font-title flex items-center">
                            <span class="bg-gradient-to-r from-cyan-400 to-blue-500 text-black rounded-full w-12 h-12 flex items-center justify-center mr-4 text-2xl font-black">5</span>
                            Usando la F√≥rmula M√°gica
                        </h3>

                        <div class="bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-6 rounded-xl border border-cyan-300/30 mb-6">
                            <h4 class="text-2xl font-bold text-cyan-300 mb-4 flex items-center">
                                <i class="fas fa-magic mr-3"></i>
                                Problema:
                            </h4>
                            <p class="text-xl leading-relaxed">
                                El MCM de dos n√∫meros es <strong>60</strong> y su MCD es <strong>4</strong>.
                                Si uno de los n√∫meros es <strong>12</strong>, ¬øcu√°l es el otro n√∫mero?
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div class="step-container">
                                <h5 class="text-xl font-bold text-cyan-300 mb-4 flex items-center step-title" data-step="17">
                                    <span class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                                    Recordar la f√≥rmula m√°gica
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-cyan-300/30" data-step="17" style="display: none;">
                                    <div class="text-center">
                                        <div class="bg-gradient-to-r from-purple-500/30 to-pink-500/30 p-6 rounded-xl border border-purple-300/50">
                                            <h6 class="text-2xl font-bold text-purple-300 mb-4">üîÆ F√≥rmula M√°gica</h6>
                                            <p class="text-3xl font-bold text-yellow-300">A √ó B = MCD(A,B) √ó MCM(A,B)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-cyan-300 mb-4 flex items-center step-title" data-step="18">
                                    <span class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                                    Sustituir valores conocidos
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-cyan-300/30" data-step="18" style="display: none;">
                                    <div class="space-y-4">
                                        <div class="bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-lg">
                                            <p class="text-lg mb-2"><strong>Datos conocidos:</strong></p>
                                            <p>‚Ä¢ A = 12 (uno de los n√∫meros)</p>
                                            <p>‚Ä¢ B = ? (el otro n√∫mero)</p>
                                            <p>‚Ä¢ MCD = 4</p>
                                            <p>‚Ä¢ MCM = 60</p>
                                        </div>
                                        <div class="bg-blue-500/20 p-4 rounded-lg text-center">
                                            <p class="text-xl">Sustituyendo en la f√≥rmula:</p>
                                            <p class="text-2xl font-bold text-blue-300">12 √ó B = 4 √ó 60</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-cyan-300 mb-4 flex items-center step-title" data-step="19">
                                    <span class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                                    Resolver la ecuaci√≥n
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-cyan-300/30" data-step="19" style="display: none;">
                                    <div class="text-center">
                                        <div class="bg-gradient-to-r from-orange-500/30 to-red-500/30 p-6 rounded-xl border border-orange-300/50">
                                            <p class="text-2xl mb-4">12 √ó B = 4 √ó 60</p>
                                            <p class="text-2xl mb-4">12 √ó B = 240</p>
                                            <p class="text-2xl mb-4">B = 240 √∑ 12</p>
                                            <p class="text-4xl font-bold text-orange-300">B = 20</p>
                                        </div>
                                        <div class="mt-4 bg-green-500/20 p-4 rounded-lg">
                                            <p class="font-bold text-yellow-300">‚úÖ El otro n√∫mero es 20</p>
                                            <p class="text-sm text-gray-300">Verificaci√≥n: 12 √ó 20 = 240, y 4 √ó 60 = 240 ‚úì</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-container">
                                <h5 class="text-xl font-bold text-cyan-300 mb-4 flex items-center step-title" data-step="20">
                                    <span class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                    Verificar usando la f√≥rmula m√°gica
                                </h5>
                                <div class="step-content bg-black/30 p-4 rounded-lg border border-cyan-300/30" data-step="20" style="display: none;">
                                    <div class="space-y-4">
                                        <p class="text-lg text-center">Vamos a verificar que nuestros valores son correctos:</p>
                                        <div class="bg-gradient-to-r from-purple-500/20 to-indigo-500/20 p-4 rounded-lg">
                                            <h6 class="font-bold text-center mb-3 text-purple-300">Verificaci√≥n con MCD y MCM</h6>
                                            <p class="text-center mb-2">Los n√∫meros encontrados: 12 y 20</p>
                                            <p class="text-center mb-2">MCD(12, 20) = 4 ‚úì (dado)</p>
                                            <p class="text-center mb-2">MCM(12, 20) = 60 ‚úì (dado)</p>
                                        </div>
                                        <div class="bg-gradient-to-r from-green-500/20 to-teal-500/20 p-4 rounded-lg text-center">
                                            <p class="text-xl font-bold mb-2">Aplicando la f√≥rmula m√°gica:</p>
                                            <p class="text-lg">12 √ó 20 = 4 √ó 60</p>
                                            <p class="text-lg">240 = 240 ‚úÖ</p>
                                            <p class="font-bold text-green-300 mt-2">¬°La f√≥rmula se cumple perfectamente!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-6">
                                <button class="btn-modern text-lg py-3 px-8 exercise-btn" data-exercise="5">
                                    <i class="fas fa-play mr-2"></i>
                                    Mostrar Soluci√≥n Paso a Paso
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-12">
                    <div class="glass modern-card p-6">
                        <h4 class="text-2xl font-bold text-yellow-300 mb-4">
                            <i class="fas fa-trophy mr-3"></i>
                            ¬°Felicitaciones!
                        </h4>
                        <p class="text-lg text-blue-200">
                            Has completado los 5 ejercicios fundamentales. Ahora est√°s listo para el EXANI-II.
                        </p>
                        <button id="practice-quiz-btn" class="btn-modern text-xl py-3 px-8 mt-4">
                            <i class="fas fa-gamepad mr-2"></i>
                            ¬°Practicar con el Quiz!
                        </button>
                    </div>
                </div>
            `;

            studyContent.innerHTML = html;

            // Add event listeners for exercise buttons
            document.querySelectorAll('.exercise-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const exerciseNum = this.getAttribute('data-exercise');
                    showExerciseSteps(exerciseNum);
                });
            });

            // Back to guide button
            document.getElementById('back-to-guide-btn').addEventListener('click', showStudyGuide);

            // Practice quiz button
            document.getElementById('practice-quiz-btn').addEventListener('click', () => {
                closeStudyMaterial();
                startGame();
            });

            // Re-render MathJax content
            if (typeof MathJax !== 'undefined') MathJax.typeset();
        }

        function showExerciseSteps(exerciseNum) {
            // Define step ranges for each exercise
            const exerciseSteps = {
                1: { start: 1, end: 4 },    // Ejercicio 1: pasos 1-4
                2: { start: 5, end: 8 },    // Ejercicio 2: pasos 5-8
                3: { start: 9, end: 12 },   // Ejercicio 3: pasos 9-12
                4: { start: 13, end: 16 },  // Ejercicio 4: pasos 13-16
                5: { start: 17, end: 20 }   // Ejercicio 5: pasos 17-20
            };

            const { start: startStep, end: endStep } = exerciseSteps[exerciseNum];

            // Hide button
            const btn = document.querySelector(`[data-exercise="${exerciseNum}"]`);
            btn.style.display = 'none';

            // Show steps with animation
            for (let i = startStep; i <= endStep; i++) {
                setTimeout(() => {
                    const stepContent = document.querySelector(`[data-step="${i}"]`);
                    if (stepContent) {
                        stepContent.style.display = 'block';
                        stepContent.style.opacity = '0';
                        stepContent.style.transform = 'translateY(20px)';

                        setTimeout(() => {
                            stepContent.style.transition = 'all 0.6s ease';
                            stepContent.style.opacity = '1';
                            stepContent.style.transform = 'translateY(0)';
                        }, 50);
                    }
                }, (i - startStep) * 800);
            }
        }

        function closeStudyMaterial() {
            studyMaterialContainer.classList.add('hidden');
            startScreen.classList.remove('hidden');
        }

        function exitQuiz() {
            // Exit quiz through QuizManager if available
            if (quizManager) {
                quizManager.exitQuiz();
            }

            // Clear timer
            clearInterval(timerInterval);

            // Hide quiz screen and show start screen
            quizScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            studyMaterialContainer.classList.add('hidden');
            startScreen.classList.remove('hidden');

            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            correctStreak = 0;
            mcmCorrect = 0;
            mcdCorrect = 0;

            // Update display
            scoreDisplay.textContent = `Puntos: ${score}`;
        }

        // Particles.js configuration
        function initParticles() {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 50, density: { enable: true, value_area: 800 } },
                    color: { value: '#ffffff' },
                    shape: { type: 'circle' },
                    opacity: { value: 0.1, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: '#ffffff',
                        opacity: 0.1,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: 'none',
                        random: false,
                        straight: false,
                        out_mode: 'out',
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: 'canvas',
                    events: {
                        onhover: { enable: true, mode: 'grab' },
                        onclick: { enable: true, mode: 'push' },
                        resize: true
                    },
                    modes: {
                        grab: { distance: 140, line_linked: { opacity: 0.3 } },
                        push: { particles_nb: 4 }
                    }
                },
                retina_detect: true
            });
        }

        // Initialize particles when page loads
        if (typeof particlesJS !== 'undefined') {
            initParticles();
        }

        // Initial setup
        updateProfileUI();

        // Event Listeners
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', () => {
             // Reset achievements for replayability in this demo
            achievements.forEach(a => a.unlocked = false);
            updateProfileUI();
            startGame();
        });
        nextButton.addEventListener('click', () => {
            if (quizManager) {
                quizManager.nextQuestion();
            }
        });
        studyGuideBtn.addEventListener('click', showStudyGuide);
        viewProblemsBtn.addEventListener('click', showProblems);
        viewSolutionsBtn.addEventListener('click', showSolutions);
        viewReferencesBtn.addEventListener('click', showReferences);
        closeStudyBtn.addEventListener('click', closeStudyMaterial);

        // Exit quiz button
        document.addEventListener('DOMContentLoaded', () => {
            const exitQuizBtn = document.getElementById('exit-quiz-btn');
            if (exitQuizBtn) {
                exitQuizBtn.addEventListener('click', exitQuiz);
            }
        });

        answerButtons.forEach(button => {
            button.addEventListener('click', selectAnswer);
        });
    </script>
</body>
</html>

